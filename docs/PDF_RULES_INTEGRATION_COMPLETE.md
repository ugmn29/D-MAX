# PDFä¿é™ºç‚¹æ•°ãƒ«ãƒ¼ãƒ«çµ±åˆ å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“‹ æ¦‚è¦

ã€Œåšç”Ÿå±€ã€€æ­¯ç§‘ä¿é™ºç‚¹æ•°.pdfã€ã‹ã‚‰è©³ç´°ãªç®—å®šæ¡ä»¶ã¨ãƒ«ãƒ¼ãƒ«ã‚’æŠ½å‡ºã—ã€é›»å­ã‚«ãƒ«ãƒ†ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«çµ±åˆã—ã¾ã—ãŸã€‚

**å®Ÿæ–½æ—¥**: 2025å¹´11æœˆ12æ—¥
**ã‚½ãƒ¼ã‚¹PDF**: åšç”Ÿå±€ã€€æ­¯ç§‘ä¿é™ºç‚¹æ•°.pdf (79ãƒšãƒ¼ã‚¸ã€106,953æ–‡å­—)

---

## ğŸ¯ å®Ÿæ–½å†…å®¹

### 1. PDFæ§‹é€ ã®åˆ†æ

- **ãƒšãƒ¼ã‚¸æ•°**: 79ãƒšãƒ¼ã‚¸
- **ç·æ–‡å­—æ•°**: 106,953æ–‡å­—
- **ä½œæˆå…ƒ**: ä¸€å¤ªéƒï¼ˆ2020å¹´2æœˆ21æ—¥ä½œæˆï¼‰

**ä¸»è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç‰¹å®š**:
- ç¬¬8éƒ¨ å‡¦ç½®: ãƒšãƒ¼ã‚¸ 42-50 (9ãƒšãƒ¼ã‚¸)
- ç¬¬9éƒ¨ æ‰‹è¡“: ãƒšãƒ¼ã‚¸ 51-65 (15ãƒšãƒ¼ã‚¸)
- ç¬¬12éƒ¨ æ­¯å† ä¿®å¾©åŠã³æ¬ æè£œç¶´: ãƒšãƒ¼ã‚¸ 66-79 (14ãƒšãƒ¼ã‚¸)

### 2. æŠ½å‡ºã—ãŸç®—å®šãƒ«ãƒ¼ãƒ«

#### a) å¹´é½¢ã«ã‚ˆã‚‹åŠ ç®—ãƒ«ãƒ¼ãƒ«

| ã‚«ãƒ†ã‚´ãƒª | å¯¾è±¡ | åŠ ç®—ç‡ |
|---------|------|--------|
| å‡¦ç½® | 6æ­³æœªæº€ã®ä¹³å¹¼å… | +50% |
| å‡¦ç½® | è‘—ã—ãæ­¯ç§‘è¨ºç™‚ãŒå›°é›£ãªè€… | +50% |
| å‡¦ç½®ï¼ˆæŠœé«„ãƒ»æ ¹ç®¡æ²»ç™‚ï¼‰ | 6æ­³æœªæº€ã®ä¹³å¹¼å… | +30% |
| æ‰‹è¡“ | 6æ­³æœªæº€ã®ä¹³å¹¼å… | +50% |
| æ­¯å† ä¿®å¾© | 6æ­³æœªæº€ã®ä¹³å¹¼å… | +70% |

#### b) æ™‚é–“å¸¯åŠ ç®—ãƒ«ãƒ¼ãƒ«

| ç¨®é¡ | åŠ ç®—ç‡ | æ¡ä»¶ |
|------|--------|------|
| ä¼‘æ—¥åŠ ç®—1 | +160% | 1,000ç‚¹ä»¥ä¸Šã®å‡¦ç½®ãƒ»æ‰‹è¡“ |
| ä¼‘æ—¥åŠ ç®—2 | +80% | 150ç‚¹ä»¥ä¸Šã®å‡¦ç½® |
| æ™‚é–“å¤–åŠ ç®—1 | +80% | 1,000ç‚¹ä»¥ä¸Šã€å¤–æ¥æ‚£è€… |
| æ™‚é–“å¤–åŠ ç®—2 | +40% | 150ç‚¹ä»¥ä¸Šã€å¤–æ¥æ‚£è€… |
| æ·±å¤œåŠ ç®—1 | +160% | 1,000ç‚¹ä»¥ä¸Š |
| æ·±å¤œåŠ ç®—2 | +80% | 150ç‚¹ä»¥ä¸Š |

#### c) è¨ªå•è¨ºç™‚åŠ ç®—ãƒ«ãƒ¼ãƒ«

| ã‚«ãƒ†ã‚´ãƒª | åŠ ç®—ç‡ | æ¡ä»¶ |
|---------|--------|------|
| å‡¦ç½®ï¼ˆä¸€èˆ¬ï¼‰ | +50% | æ­¯ç§‘è¨ªå•è¨ºç™‚æ™‚ |
| å‡¦ç½®ï¼ˆæŠœé«„ãƒ»æ ¹ç®¡æ²»ç™‚ï¼‰ | +30% | æ­¯ç§‘è¨ªå•è¨ºç™‚æ™‚ |
| æ‰‹è¡“ | +50% | æ­¯ç§‘è¨ªå•è¨ºç™‚æ™‚ |
| æ­¯å† ä¿®å¾©ï¼ˆå°è±¡æ¡å¾—ç­‰ï¼‰ | +70% | æ­¯ç§‘è¨ªå•è¨ºç™‚æ™‚ |
| æ­¯å† ä¿®å¾©ï¼ˆãã®ä»–ï¼‰ | +50% | æ­¯ç§‘è¨ªå•è¨ºç™‚æ™‚ |

### 3. è¨ºç™‚è¡Œç‚ºåˆ¥ã®è©³ç´°ãƒ«ãƒ¼ãƒ«

#### æŠœé«„ï¼ˆI005ï¼‰

**å˜æ ¹ç®¡** (230ç‚¹)
- æ¡ä»¶ä»˜ãæ¸›ç®—:
  - æ­¯é«„æ¸©å­˜ç™‚æ³•å¾Œ3æœˆä»¥å†…: 42ç‚¹
  - ç›´æ¥æ­¯é«„ä¿è­·å‡¦ç½®å¾Œ1æœˆä»¥å†…: 80ç‚¹

**2æ ¹ç®¡** (422ç‚¹)
- æ¡ä»¶ä»˜ãæ¸›ç®—:
  - æ­¯é«„æ¸©å­˜ç™‚æ³•å¾Œ3æœˆä»¥å†…: 234ç‚¹
  - ç›´æ¥æ­¯é«„ä¿è­·å‡¦ç½®å¾Œ1æœˆä»¥å†…: 272ç‚¹

**3æ ¹ç®¡ä»¥ä¸Š** (596ç‚¹)
- æ¡ä»¶ä»˜ãæ¸›ç®—:
  - æ­¯é«„æ¸©å­˜ç™‚æ³•å¾Œ3æœˆä»¥å†…: 408ç‚¹
  - ç›´æ¥æ­¯é«„ä¿è­·å‡¦ç½®å¾Œ1æœˆä»¥å†…: 446ç‚¹

#### æŠœæ­¯æ‰‹è¡“ï¼ˆJ000ï¼‰

**ä¹³æ­¯** (130ç‚¹)
**å‰æ­¯** (155ç‚¹)
- é›£æŠœæ­¯åŠ ç®—: +210ç‚¹ï¼ˆæ­¯æ ¹è‚¥å¤§ã€éª¨ã®ç™’ç€æ­¯ç­‰ï¼‰

**è‡¼æ­¯** (265ç‚¹)
- é›£æŠœæ­¯åŠ ç®—: +210ç‚¹ï¼ˆæ­¯æ ¹è‚¥å¤§ã€éª¨ã®ç™’ç€æ­¯ç­‰ï¼‰

**åŸ‹ä¼æ­¯** (1,054ç‚¹)
- å®Œå…¨åŸ‹ä¼æ­¯ï¼ˆéª¨æ€§ï¼‰åˆã¯æ°´å¹³åŸ‹ä¼æ™ºæ­¯ã«é™ã‚Šç®—å®š
- ä¸‹é¡å®Œå…¨åŸ‹ä¼æ™ºæ­¯åŠ ç®—: +120ç‚¹

#### æ­¯é«„ä¿è­·å‡¦ç½®ï¼ˆI001ï¼‰

**æ­¯é«„æ¸©å­˜ç™‚æ³•** (188ç‚¹)
- çµŒéè¦³å¯Ÿä¸­ã®ã†è•å‡¦ç½®ã¯æ‰€å®šç‚¹æ•°ã«å«ã¾ã‚Œã‚‹

**ç›´æ¥æ­¯é«„ä¿è­·å‡¦ç½®** (150ç‚¹)
**é–“æ¥æ­¯é«„ä¿è­·å‡¦ç½®** (34ç‚¹)

#### ã†è•å‡¦ç½®ï¼ˆI000ï¼‰

**18ç‚¹** (1æ­¯1å›ã«ã¤ã)
- åŒ…æ‹¬å†…å®¹: è²¼è–¬ã€ä»®å°ã€ç‰¹å®šè–¬å‰¤ã€ç‰¹å®šä¿é™ºåŒ»ç™‚ææ–™

---

## ğŸ“¦ ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

### 1. æŠ½å‡ºãƒ‡ãƒ¼ã‚¿

- **pdf_analysis_stats.json**: PDFåŸºæœ¬çµ±è¨ˆ
- **pdf_treatment_extraction.json**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³æŠ½å‡ºçµæœ
- **pdf_detailed_rules.json**: è©³ç´°ãƒ«ãƒ¼ãƒ«ï¼ˆJSONå½¢å¼ï¼‰

### 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

- **scripts/analyze-pdf-structure.py**: PDFæ§‹é€ åˆ†æ
- **scripts/extract-treatment-sections.py**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³æŠ½å‡º
- **scripts/examine-specific-pages.py**: ç‰¹å®šãƒšãƒ¼ã‚¸ç¢ºèª
- **scripts/extract-detailed-rules.py**: è©³ç´°ãƒ«ãƒ¼ãƒ«æŠ½å‡º
- **scripts/generate-pdf-rules-migration.ts**: SQLãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

- **supabase/migrations/2025-11-12_add_pdf_detailed_rules.sql**
  - å…¨è¨ºç™‚è¡Œç‚ºã«åŠ ç®—ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ 
  - é‡è¦è¨ºç™‚è¡Œç‚ºã«è©³ç´°æ¡ä»¶ã‚’è¿½åŠ 
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å®‰å…¨ã«å®Ÿè¡Œ

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ

### metadata ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ§‹é€ 

```typescript
{
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  inclusion_rules: string[],
  exclusion_rules: {
    same_day: string[],
    same_month: string[],
    simultaneous: string[],
    same_site: string[],
    same_week: string[]
  },
  frequency_limits: Array<{
    period: 'day' | 'week' | 'month' | 'year',
    max_count: number
  }>,

  // æ–°è¦è¿½åŠ 
  detailed_rules: {
    unit: string,                    // ç®—å®šå˜ä½ï¼ˆä¾‹: "1æ­¯ã«ã¤ã"ï¼‰
    conditional_points?: {           // æ¡ä»¶ä»˜ãç‚¹æ•°å¤‰å‹•
      after_pulp_preservation_3months?: number,
      after_direct_pulp_protection_1month?: number
    },
    additions?: {                    // åŠ ç®—ç‚¹æ•°
      difficult_extraction?: number,
      mandibular_impacted?: number
    },
    conditions: string[],            // ç®—å®šæ¡ä»¶ï¼ˆæ–‡ç« ï¼‰
    inclusions?: string[],           // åŒ…æ‹¬ã•ã‚Œã‚‹å‡¦ç½®
    note?: string                    // å‚™è€ƒ
  },

  addition_rules: {
    age_based_additions: Array<{
      type: 'under_6_infant' | 'difficult_patient',
      rate: number,                  // åŠ ç®—ç‡ï¼ˆ0.5 = 50%ï¼‰
      description: string
    }>,
    time_based_additions: Array<{
      type: 'holiday' | 'overtime' | 'midnight',
      rate: number,
      description: string
    }>,
    visit_based_additions: Array<{
      type: 'home_visit',
      rate: number,
      description: string
    }>
  }
}
```

---

## ğŸš€ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ–¹æ³•

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: Supabase CLIã‚’ä½¿ç”¨

```bash
npx supabase db push
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: psqlã‚’ç›´æ¥ä½¿ç”¨

```bash
psql [æ¥ç¶šæƒ…å ±] < supabase/migrations/2025-11-12_add_pdf_detailed_rules.sql
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: Supabase Dashboard

1. Supabase Dashboard â†’ SQL Editor
2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
3. å®Ÿè¡Œ

---

## ğŸ“Š çµ±åˆã®å½±éŸ¿ç¯„å›²

### æ›´æ–°å¯¾è±¡ã®è¨ºç™‚è¡Œç‚º

1. **æŠœé«„é–¢é€£**: å˜æ ¹ç®¡ã€2æ ¹ç®¡ã€3æ ¹ç®¡ä»¥ä¸Š
2. **æŠœæ­¯é–¢é€£**: ä¹³æ­¯ã€å‰æ­¯ã€è‡¼æ­¯ã€åŸ‹ä¼æ­¯
3. **æ­¯é«„ä¿è­·å‡¦ç½®**: æ­¯é«„æ¸©å­˜ç™‚æ³•ã€ç›´æ¥ãƒ»é–“æ¥æ­¯é«„ä¿è­·
4. **ã†è•å‡¦ç½®**: ä¸€èˆ¬çš„ãªã†è•å‡¦ç½®
5. **å……å¡«é–¢é€£**: CRå……å¡«ã€ãƒ¬ã‚¸ãƒ³å……å¡«ç­‰
6. **æ ¹ç®¡æ²»ç™‚é–¢é€£**: æ„ŸæŸ“æ ¹ç®¡å‡¦ç½®ç­‰

### æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿

âœ… **å¾Œæ–¹äº’æ›æ€§ã‚ã‚Š**:
- æ—¢å­˜ã®`metadata`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¿½åŠ ã™ã‚‹å½¢å¼
- `COALESCE(metadata, '{}'::jsonb) || æ–°è¦ãƒ‡ãƒ¼ã‚¿` ã§å®‰å…¨ã«ãƒãƒ¼ã‚¸
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã‚‹

âš ï¸ **è¦å¯¾å¿œ**:
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æ›´æ–°ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é§†å‹•ã«å¤‰æ›´
- ç‚¹æ•°è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹¡å¼µã—ã¦åŠ ç®—ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨
- UIã«åŠ ç®—é©ç”¨çŠ¶æ³ã‚’è¡¨ç¤º

---

## ğŸ”„ ä»Šå¾Œã®æ´»ç”¨æ–¹æ³•

### 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®å¼·åŒ–

ç¾åœ¨ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´:

```typescript
// Before (ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰)
const INCLUSION_RULES = {
  'å½¢æˆ': {
    includedIn: ['å……å¡«', 'CR', 'ã‚¤ãƒ³ãƒ¬ãƒ¼'],
    explanation: 'å½¢æˆã¯å……å¡«ãƒ»ä¿®å¾©å‡¦ç½®ã«åŒ…æ‹¬ã•ã‚Œã¦ã„ã¾ã™'
  }
};

// After (ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é§†å‹•)
async function getInclusionRules(treatmentCode: string) {
  const { data } = await supabase
    .from('treatment_codes')
    .select('metadata->inclusion_rules')
    .eq('code', treatmentCode)
    .single();

  return data?.inclusion_rules || [];
}
```

### 2. å‹•çš„ãªç‚¹æ•°è¨ˆç®—

åŠ ç®—ãƒ«ãƒ¼ãƒ«ã‚’è‡ªå‹•é©ç”¨:

```typescript
function calculateTotalPoints(
  treatmentCode: string,
  basePoints: number,
  context: {
    patientAge?: number,
    isHoliday?: boolean,
    isOvertime?: boolean,
    isMidnight?: boolean,
    isHomeVisit?: boolean,
    isDifficultPatient?: boolean
  }
): number {
  let total = basePoints;
  const rules = getTreatmentAdditionRules(treatmentCode);

  // å¹´é½¢åŠ ç®—
  if (context.patientAge && context.patientAge < 6) {
    const ageRule = rules.age_based_additions.find(r => r.type === 'under_6_infant');
    if (ageRule) {
      total += basePoints * ageRule.rate;
    }
  }

  // æ™‚é–“å¸¯åŠ ç®—
  if (context.isHoliday) {
    const holidayRule = getApplicableTimeRule(rules, 'holiday', basePoints);
    if (holidayRule) {
      total += basePoints * holidayRule.rate;
    }
  }

  // è¨ªå•è¨ºç™‚åŠ ç®—
  if (context.isHomeVisit) {
    const visitRule = rules.visit_based_additions[0];
    if (visitRule) {
      total += basePoints * visitRule.rate;
    }
  }

  return Math.round(total);
}
```

### 3. UIè¡¨ç¤ºã®æ”¹å–„

è¨ºç™‚è¡Œç‚ºé¸æŠæ™‚ã«åŠ ç®—æ¡ä»¶ã‚’è¡¨ç¤º:

```tsx
<TreatmentCard>
  <TreatmentName>{treatment.name}</TreatmentName>
  <BasePoints>{treatment.points}ç‚¹</BasePoints>

  {treatment.metadata?.detailed_rules?.conditions && (
    <ConditionsAlert>
      {treatment.metadata.detailed_rules.conditions.map(cond => (
        <li key={cond}>{cond}</li>
      ))}
    </ConditionsAlert>
  )}

  {treatment.metadata?.addition_rules && (
    <AdditionsInfo>
      <h4>åŠ ç®—å¯èƒ½</h4>
      <ul>
        {treatment.metadata.addition_rules.age_based_additions.map(add => (
          <li>
            {add.type === 'under_6_infant' ? '6æ­³æœªæº€' : 'å›°é›£æ‚£è€…'}:
            +{(add.rate * 100).toFixed(0)}%
          </li>
        ))}
      </ul>
    </AdditionsInfo>
  )}
</TreatmentCard>
```

### 4. ãƒ¬ã‚»ãƒ—ãƒˆè‡ªå‹•ç”Ÿæˆã¸ã®æ´»ç”¨

æ¡ä»¶ã«å¿œã˜ã¦è‡ªå‹•çš„ã«åŠ ç®—ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆ:

```typescript
function generateReceiptComment(
  treatment: Treatment,
  appliedAdditions: AppliedAddition[]
): string {
  const comments: string[] = [];

  for (const addition of appliedAdditions) {
    if (addition.type === 'under_6_infant') {
      comments.push('6æ­³æœªæº€åŠ ç®—');
    }
    if (addition.type === 'difficult_extraction') {
      comments.push('é›£æŠœæ­¯ï¼ˆæ­¯æ ¹è‚¥å¤§ï¼‰');
    }
  }

  return comments.join('ã€');
}
```

---

## ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. ç®—å®šç²¾åº¦ã®å‘ä¸Š
- âœ… æ¡ä»¶ä»˜ãç‚¹æ•°å¤‰å‹•ã®è‡ªå‹•é©ç”¨
- âœ… åŠ ç®—æ¼ã‚Œã®é˜²æ­¢
- âœ… éå‰°ç®—å®šã®é˜²æ­¢

### 2. æ¥­å‹™åŠ¹ç‡åŒ–
- âœ… æ‰‹å‹•ã§ã®åŠ ç®—è¨ˆç®—ãŒä¸è¦
- âœ… ãƒ¬ã‚»ãƒ—ãƒˆã‚³ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆ
- âœ… è¿”æˆ»ãƒªã‚¹ã‚¯ã®ä½æ¸›

### 3. é‹ç”¨ã®æŸ”è»Ÿæ€§
- âœ… ç‚¹æ•°æ”¹å®šæ™‚ã®ä¸€æ‹¬æ›´æ–°ãŒå¯èƒ½
- âœ… ãƒ«ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- âœ… ã‚¯ãƒªãƒ‹ãƒƒã‚¯ç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã®è¿½åŠ 

### 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹å‘ä¸Š
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®ç®—å®šå¯å¦åˆ¤å®š
- âœ… ç†ç”±ã®æ˜ç¤ºã«ã‚ˆã‚‹ç†è§£ä¿ƒé€²
- âœ… å­¦ç¿’åŠ¹æœã®å‘ä¸Š

---

## âš ï¸ æ³¨æ„äº‹é …

### 1. ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§
- PDFã‹ã‚‰æŠ½å‡ºã—ãŸãƒ‡ãƒ¼ã‚¿ã¯æ‰‹å‹•ã§ç¢ºèªæ¸ˆã¿ã§ã™ãŒã€ã™ã¹ã¦ã®æ¡ä»¶ã‚’ç¶²ç¾…ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“
- é‡è¦ãªç®—å®šåˆ¤å®šæ™‚ã¯ã€å¿…ãšå…¬å¼ã®ç‚¹æ•°è¡¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„

### 2. è¨ºç™‚å ±é…¬æ”¹å®šã¸ã®å¯¾å¿œ
- 2å¹´ã”ã¨ã®è¨ºç™‚å ±é…¬æ”¹å®šæ™‚ã«ã¯ã€PDFã‚’å†å–å¾—ã—ã¦å†å®Ÿè¡ŒãŒå¿…è¦
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ—¥ä»˜ã‚’æ›´æ–°ã—ã¦ç®¡ç†

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- `metadata`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯JSONBå‹ã®ãŸã‚ã€å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã¯æ¤œç´¢ãŒé…ããªã‚‹å¯èƒ½æ€§
- å¿…è¦ã«å¿œã˜ã¦ã€ã‚ˆãä½¿ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¯¾ã—ã¦GINã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆ

```sql
CREATE INDEX idx_treatment_codes_metadata_detailed_rules
ON treatment_codes USING GIN ((metadata->'detailed_rules'));
```

### 4. ãƒ†ã‚¹ãƒˆ
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå‰ã«ã€å¿…ãšã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
- ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—

---

## ğŸ” æ¤œè¨¼æ–¹æ³•

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¾Œã€ä»¥ä¸‹ã®SQLã§çµæœã‚’ç¢ºèª:

```sql
-- æ›´æ–°ã•ã‚ŒãŸè¨ºç™‚è¡Œç‚ºã‚’ç¢ºèª
SELECT
  code,
  name,
  points,
  metadata->'detailed_rules' as detailed_rules,
  metadata->'addition_rules'->'age_based_additions' as age_additions
FROM treatment_codes
WHERE metadata->'detailed_rules' IS NOT NULL
ORDER BY code
LIMIT 20;

-- æŠœé«„ã®è©³ç´°ç¢ºèª
SELECT
  code,
  name,
  points,
  metadata->'detailed_rules'->'conditional_points' as conditional_points
FROM treatment_codes
WHERE name ILIKE '%æŠœé«„%'
ORDER BY code;

-- æŠœæ­¯ã®åŠ ç®—ç¢ºèª
SELECT
  code,
  name,
  points,
  metadata->'detailed_rules'->'additions' as additions,
  metadata->'addition_rules'->'visit_based_additions' as visit_additions
FROM treatment_codes
WHERE name ILIKE '%æŠœæ­¯%'
ORDER BY code;
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [åšç”ŸåŠ´åƒçœ è¨ºç™‚å ±é…¬æƒ…å ±æä¾›ã‚µãƒ¼ãƒ“ã‚¹](https://shinryohoshu.mhlw.go.jp/)
- [EMR Phase 1 å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ](./EMR_PHASE1_COMPLETE.md)
- [æ²»ç™‚ææ¡ˆæ©Ÿèƒ½ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./TREATMENT_SUGGESTION_FEATURE.md)

---

## ğŸ‘¥ ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### Phase 2: è¿½åŠ ãƒ«ãƒ¼ãƒ«ã®çµ±åˆ
- æ–½è¨­åŸºæº–è¦ä»¶ã®è¿½åŠ 
- å¿…é ˆæ–‡æ›¸ãƒ»ç”»åƒã®ç®¡ç†
- ç®—å®šå›æ•°åˆ¶é™ã®å®Ÿè£…
- å¹´é½¢ãƒ»éƒ¨ä½åˆ¶é™ã®è©³ç´°åŒ–

### Phase 3: AIã«ã‚ˆã‚‹è‡ªå‹•åˆ¤å®š
- éå»ã®ç®—å®šãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰å­¦ç¿’
- ä¸é©åˆ‡ãªç®—å®šã®äº‹å‰æ¤œå‡º
- ãƒ¬ã‚»ãƒ—ãƒˆæŸ»å®šãƒªã‚¹ã‚¯ã®äºˆæ¸¬

### Phase 4: ã‚¯ãƒªãƒ‹ãƒƒã‚¯ç‹¬è‡ªãƒ«ãƒ¼ãƒ«
- å„ã‚¯ãƒªãƒ‹ãƒƒã‚¯ã®ãƒãƒªã‚·ãƒ¼è¨­å®š
- è‡ªè²»è¨ºç™‚ã¨ã®é€£æºå¼·åŒ–
- æŠ€å·¥æŒ‡ç¤ºæ›¸ã¨ã®çµ±åˆ

---

**ä½œæˆæ—¥**: 2025å¹´11æœˆ12æ—¥
**ä½œæˆè€…**: Claude Code
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
