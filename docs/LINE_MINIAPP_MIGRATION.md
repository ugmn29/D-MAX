# LIFF → LINEミニアプリ 移行ガイド

## 📢 重要なお知らせ

LINEは2024年以降、**LIFF（LINE Front-end Framework）**と**LINEミニアプリ**を統合する方向に進んでいます。

---

## 現状の整理（2025年1月時点）

### LIFFの状況
- ✅ **現在も利用可能**
- ✅ **既存のLIFFアプリは動作し続ける**
- ⚠️ 将来的にLINEミニアプリに統合予定
- ⚠️ 新規作成は「LINEミニアプリ」として作成

### LINEミニアプリとは
- LIFF v2 の後継として位置づけ
- より高機能（オフライン対応、プッシュ通知など）
- 開発方法は**ほぼLIFFと同じ**
- 同じ技術スタック（Next.js、React対応）

---

## 🎯 D-MAXへの影響と対応

### 良いニュース ✅

**ほぼ影響なし**です！理由：

1. **コードはそのまま使える**
   - 現在実装しているLIFF画面（Next.js + React）はLINEミニアプリでもそのまま動作
   - `window.liff.init()` などのAPIも互換性あり

2. **移行は段階的**
   - LINE側が自動的に移行をサポート
   - 既存LIFFアプリは引き続き動作

3. **設定方法がほぼ同じ**
   - LINE Developers Console での作成手順はほぼ同じ
   - エンドポイントURL、Scopeなどの概念は共通

---

## 📋 LINEミニアプリでの設定方法

### 現在の設定方法との違い

#### LIFF（旧）の作成方法
```
LINE Developers Console
→ チャネル選択
→ 「LIFF」タブ
→ 「追加」ボタン
→ LIFF ID発行
```

#### LINEミニアプリ（新）の作成方法
```
LINE Developers Console
→ チャネル選択
→ 「LINEミニアプリ」タブ ← ここだけ違う
→ 「追加」ボタン
→ ミニアプリ ID発行
```

### 設定項目の対応表

| 項目 | LIFF | LINEミニアプリ | 備考 |
|------|------|--------------|------|
| **名前** | LIFFアプリ名 | ミニアプリ名 | 同じ |
| **サイズ** | Compact/Tall/Full | 同じ | 同じ |
| **エンドポイントURL** | エンドポイントURL | サービスURL | 名称変更のみ |
| **Scope** | profile, openid等 | 同じ | 同じ |
| **ID** | LIFF ID | ミニアプリID | 形式は同じ |

---

## 🔄 移行手順（将来的に必要な場合）

### ステップ1: 現状確認

現在のLIFFアプリが自動的にミニアプリに移行されているか確認：

```
LINE Developers Console
→ チャネル選択
→ 「LIFF」タブと「LINEミニアプリ」タブの両方を確認
```

### ステップ2: 新規作成の場合

新しい医院でLINE連携を設定する場合：

```
【2025年以降の設定手順】

1. LINE Developers Console にログイン
2. チャネル選択
3. 「LINEミニアプリ」タブをクリック ← ここが変更
4. 「追加」ボタン
5. 以下を入力:
   - ミニアプリ名: 〇〇歯科クリニック - 初回連携
   - サイズ: Tall
   - サービスURL: https://yourdomain.com/liff/initial-link
   - Scope: profile, openid
6. ミニアプリIDをコピー
7. .env.local に設定（変数名は同じでOK）
```

### ステップ3: コード修正（ほぼ不要）

**D-MAXのコードは修正不要**です。理由：

```typescript
// 現在のコード（このままでOK）
useEffect(() => {
  if (typeof window !== 'undefined' && window.liff) {
    const liffId = process.env.NEXT_PUBLIC_LIFF_ID_INITIAL_LINK
    await window.liff.init({ liffId })

    if (window.liff.isLoggedIn()) {
      const profile = await window.liff.getProfile()
      // ...
    }
  }
}, [])
```

LINEミニアプリでも`window.liff`オブジェクトは同じように動作します。

---

## 💡 推奨対応方針

### 現時点（2025年1月）

**何もしなくてOK** ✅

理由：
1. LIFFは引き続き動作
2. LINE側が段階的に移行をサポート
3. 既存の実装は互換性あり

### 新規医院追加時

**「LINEミニアプリ」として作成** 🆕

- LINE Developers Consoleで「LINEミニアプリ」タブから作成
- 設定手順はほぼ同じ
- 発行されたIDを`.env.local`に設定

### 既存医院の移行時期

**LINE公式から移行案内が来たら対応**

- 自動移行される可能性が高い
- 手動移行が必要な場合もLINEがガイドを提供
- D-MAXのコード修正は不要

---

## 📝 ドキュメント更新箇所

### 1. LINE_SETUP_STEP_BY_STEP.md の修正

#### ステップ5の見出しを修正

**変更前:**
```markdown
## ステップ5: LIFFアプリを作る（15分）
```

**変更後:**
```markdown
## ステップ5: LINEミニアプリを作る（15分）

⚠️ **注意**: 2025年以降、「LIFF」タブが「LINEミニアプリ」タブに変更されている場合があります。
その場合は「LINEミニアプリ」タブから作成してください。手順は同じです。
```

#### 5-1の修正

**変更前:**
```markdown
### 5-1. LIFF タブを開く

1. チャネル画面の「LIFF」タブをクリック
2. 「追加」ボタンをクリック
```

**変更後:**
```markdown
### 5-1. LINEミニアプリ（またはLIFF）タブを開く

1. チャネル画面で以下のいずれかのタブをクリック:
   - **「LINEミニアプリ」タブ**（2025年以降の新UIの場合）
   - **「LIFF」タブ**（従来のUIの場合）
2. 「追加」ボタンをクリック

💡 タブ名が違っても、設定内容は同じです。
```

#### 5-2の修正

**変更前:**
```markdown
### 5-2. LIFF 1個目: 初回連携

以下の項目を入力：

#### LIFFアプリ名
```

**変更後:**
```markdown
### 5-2. ミニアプリ 1個目: 初回連携

以下の項目を入力：

#### アプリ名（またはLIFFアプリ名）
```
〇〇歯科クリニック - 初回連携
```

#### エンドポイントURL（またはサービスURL）
```

---

## 🔍 確認方法

### 自分の環境がどちらか確認

```
1. LINE Developers Console にログイン
2. 任意のチャネルを開く
3. タブを確認:

   【パターンA: 新UI】
   - 「LINEミニアプリ」タブがある → ミニアプリで作成

   【パターンB: 旧UI】
   - 「LIFF」タブのみ → LIFFで作成

   【パターンC: 移行期】
   - 両方のタブがある → どちらでも作成可能
```

---

## 💻 コード上の対応

### 環境変数名の統一提案

将来的な混乱を避けるため、環境変数名を以下のように統一することを推奨：

#### 現在の変数名
```bash
NEXT_PUBLIC_LIFF_ID_INITIAL_LINK=1234567890-abcdefgh
NEXT_PUBLIC_LIFF_ID_QR_CODE=1234567890-xxxxxxxx
# ...
```

#### 推奨する変数名（後方互換性あり）
```bash
# LIFF IDでもミニアプリIDでも同じ変数に設定
NEXT_PUBLIC_LINE_APP_ID_INITIAL_LINK=1234567890-abcdefgh
NEXT_PUBLIC_LINE_APP_ID_QR_CODE=1234567890-xxxxxxxx
# ...

# または従来のまま（どちらでもOK）
NEXT_PUBLIC_LIFF_ID_INITIAL_LINK=1234567890-abcdefgh
```

**理由**: LIFFとミニアプリでIDの形式は同じため、変数名を変更する必要はありません。

---

## ❓ FAQ

### Q1: 既存のLIFFアプリは動かなくなる？
**A**: いいえ、引き続き動作します。
- LINE側が互換性を保証
- 自動移行される可能性が高い

### Q2: 今すぐ対応が必要？
**A**: いいえ、必要ありません。
- 現在のLIFFアプリはそのまま使用可能
- 新規作成時のみ「LINEミニアプリ」を選択

### Q3: コードの修正は必要？
**A**: 基本的に不要です。
- `window.liff` APIは互換性あり
- エンドポイントURLも同じ
- 環境変数の変更も不要

### Q4: 新しい医院を追加する場合は？
**A**: 「LINEミニアプリ」タブから作成してください。
- 設定手順は従来のLIFFと同じ
- 発行されたIDを`.env.local`に設定
- D-MAXのコードはそのまま動作

### Q5: 移行スケジュールは？
**A**: LINE公式からの正式発表待ちです。
- 2024年後半から段階的に統合開始
- 既存LIFFアプリは引き続き動作
- 移行案内が来たら対応

---

## 📢 公式情報の確認

最新情報は以下で確認できます：

### LINE Developers 公式ドキュメント
```
https://developers.line.biz/ja/docs/liff/
```

### LINEミニアプリ 公式ドキュメント
```
https://developers.line.biz/ja/docs/line-mini-app/
```

### 移行ガイド（公開されたら）
```
https://developers.line.biz/ja/news/
```

---

## ✅ まとめ

### 現時点での対応（2025年1月）

1. **既存実装**: 何も変更不要 ✅
2. **新規医院**: LINEミニアプリで作成（設定方法は同じ）
3. **コード**: 修正不要 ✅
4. **ドキュメント**: 若干の文言修正のみ

### 今後の見通し

- LIFFとミニアプリは**実質同じもの**として扱われる
- 技術的な互換性は保たれる
- D-MAXの実装に大きな影響はない

### 推奨アクション

✅ **今すぐ**: 何もしなくてOK
✅ **新規医院追加時**: 「LINEミニアプリ」で作成
✅ **移行案内が来たら**: LINE公式の指示に従う

---

**結論: 心配不要です！** 🎉

D-MAXの現在の実装は、LINEミニアプリでもそのまま動作します。
新規医院追加時に「LINEミニアプリ」タブから作成するだけで、コード修正は不要です。
