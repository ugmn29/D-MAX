-- 新しい初診問診票の作成と質問項目の挿入
-- 仮のクリニックID（実際の環境では適切なIDに変更してください）
INSERT INTO questionnaires (id, clinic_id, name, description, is_active) 
VALUES (
    '11111111-1111-1111-1111-111111111112',
    '11111111-1111-1111-1111-111111111111',
    '初診問診票',
    '初診患者用の詳細問診票',
    true
);

-- 患者情報セクション
INSERT INTO questionnaire_questions (questionnaire_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('11111111-1111-1111-1111-111111111112', '患者情報', '日付', 'date', NULL, true, 1),
('11111111-1111-1111-1111-111111111112', '患者情報', 'ふりがな', 'text', NULL, true, 2),
('11111111-1111-1111-1111-111111111112', '患者情報', '氏名', 'text', NULL, true, 3),
('11111111-1111-1111-1111-111111111112', '患者情報', '性別', 'radio', '["男", "女"]', true, 4),
('11111111-1111-1111-1111-111111111112', '患者情報', '生年月日（元号）', 'select', '["明治", "大正", "昭和", "平成", "令和"]', true, 5),
('11111111-1111-1111-1111-111111111112', '患者情報', '生年月日（年）', 'number', NULL, true, 6),
('11111111-1111-1111-1111-111111111112', '患者情報', '生年月日（月）', 'number', NULL, true, 7),
('11111111-1111-1111-1111-111111111112', '患者情報', '生年月日（日）', 'number', NULL, true, 8),
('11111111-1111-1111-1111-111111111112', '患者情報', '血液型', 'select', '["A", "B", "AB", "O", "不明"]', false, 9),
('11111111-1111-1111-1111-111111111112', '患者情報', '郵便番号', 'text', NULL, true, 10),
('11111111-1111-1111-1111-111111111112', '患者情報', '住所', 'text', NULL, true, 11),
('11111111-1111-1111-1111-111111111112', '患者情報', '自宅電話番号', 'text', NULL, false, 12),
('11111111-1111-1111-1111-111111111112', '患者情報', '携帯電話番号', 'text', NULL, true, 13),
('11111111-1111-1111-1111-111111111112', '患者情報', 'Eメールアドレス', 'text', NULL, false, 14),
('11111111-1111-1111-1111-111111111112', '患者情報', '来院のきっかけ', 'select', '["Google検索・HP", "Google Map", "Epark", "Instagram", "YouTube", "ご紹介"]', false, 15),
('11111111-1111-1111-1111-111111111112', '患者情報', '紹介者指名', 'text', NULL, false, 16);

-- 主訴・症状セクション
INSERT INTO questionnaire_questions (questionnaire_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('11111111-1111-1111-1111-111111111112', '主訴・症状', 'どうなさいましたか（来院目的）', 'checkbox', '["虫歯の治療をしたい", "検査をしてほしい", "歯がしみる", "入れ歯をいれたい", "歯がかけた", "歯肉が腫れた", "歯の清掃をしたい", "前につめた物がとれた", "顎関節が痛む", "親知らずを抜きたい", "口内炎が出来た", "その他"]', true, 17),
('11111111-1111-1111-1111-111111111112', '主訴・症状', '痛む場所（部位）', 'checkbox', '["右上", "上前", "左上", "右下", "下前", "左下"]', false, 18),
('11111111-1111-1111-1111-111111111112', '主訴・症状', '痛む場所（組織）', 'checkbox', '["歯", "歯肉", "頬", "顎", "舌", "唇"]', false, 19),
('11111111-1111-1111-1111-111111111112', '主訴・症状', 'いつから痛みますか', 'radio', '["今日初めて", "昨日から", "＿日くらい前から", "時々", "ずっと前から", "現在は痛みはない"]', false, 20),
('11111111-1111-1111-1111-111111111112', '主訴・症状', '痛み方', 'checkbox', '["ズキズキ", "噛んだ時に痛む", "痛んだり止んだり", "冷たい物がしみる", "熱い物がしみる", "夜になると痛む", "甘い物で痛む", "物が挟まって痛む"]', false, 21);

-- 問診セクション
INSERT INTO questionnaire_questions (questionnaire_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('11111111-1111-1111-1111-111111111112', '問診', 'ご職業', 'radio', '["会社員", "自営業", "公務員", "パート・アルバイト", "学生", "無職", "その他"]', true, 22),
('11111111-1111-1111-1111-111111111112', '問診', '通勤・勤務中のけがですか', 'radio', '["はい", "いいえ"]', true, 23),
('11111111-1111-1111-1111-111111111112', '問診', '歯の色は気になりますか', 'radio', '["はい", "いいえ"]', true, 24),
('11111111-1111-1111-1111-111111111112', '問診', '歯の色で気になる点', 'checkbox', '["全体的な色合い（ホワイトニング）", "被せ物や詰め物の色", "タバコ、コーヒー等の着色", "その他"]', false, 25),
('11111111-1111-1111-1111-111111111112', '問診', '身長', 'number', NULL, false, 26),
('11111111-1111-1111-1111-111111111112', '問診', '体重', 'number', NULL, false, 27),
('11111111-1111-1111-1111-111111111112', '問診', '麻酔や抜歯での異常経験', 'radio', '["ない", "ある"]', true, 28),
('11111111-1111-1111-1111-111111111112', '問診', '麻酔・抜歯異常の詳細', 'checkbox', '["麻酔が効かなかった", "気分が悪くなる", "血が止まらない"]', false, 29),
('11111111-1111-1111-1111-111111111112', '問診', '薬・食物・金属などのアレルギー', 'radio', '["ない", "ある"]', true, 30),
('11111111-1111-1111-1111-111111111112', '問診', 'アレルギーの詳細', 'checkbox', '["気分が悪くなる", "息苦しくなった", "発疹が出た"]', false, 31),
('11111111-1111-1111-1111-111111111112', '問診', 'アレルギーの原因', 'text', NULL, false, 32),
('11111111-1111-1111-1111-111111111112', '問診', '持病・通院中の病気', 'radio', '["ない", "ある"]', true, 33),
('11111111-1111-1111-1111-111111111112', '問診', '具体的な持病', 'checkbox', '["高血圧", "糖尿病", "心血管疾患・不整脈（6ヶ月以内の発作の有無、ペースメーカーの有無）", "脳血管障害（6ヶ月以内の発作の有無）", "呼吸器疾患", "骨粗しょう症", "リウマチ", "肝機能障害", "腎機能障害（透析の有無、曜日、腕の左右）", "B型・C型肝炎", "HIV・梅毒", "血液疾患", "悪性腫瘍（放射線治療または抗がん剤治療の経験の有無）", "その他"]', false, 34),
('11111111-1111-1111-1111-111111111112', '問診', '病名・病院名・診療科・医師名', 'textarea', NULL, false, 35),
('11111111-1111-1111-1111-111111111112', '問診', '現在服用しているお薬', 'radio', '["ない", "ある"]', true, 36),
('11111111-1111-1111-1111-111111111112', '問診', '薬剤名・お薬手帳の有無・定期的な点滴・注射の有無', 'textarea', NULL, false, 37),
('11111111-1111-1111-1111-111111111112', '問診', '妊娠・授乳の有無', 'radio', '["いいえ", "はい"]', true, 38),
('11111111-1111-1111-1111-111111111112', '問診', '妊娠週数', 'radio', '["第0～15週", "第16～27週", "第28週以降"]', false, 39),
('11111111-1111-1111-1111-111111111112', '問診', '出産予定日', 'date', NULL, false, 40),
('11111111-1111-1111-1111-111111111112', '問診', '授乳中', 'checkbox', '["授乳中"]', false, 41),
('11111111-1111-1111-1111-111111111112', '問診', '入れ歯の使用', 'radio', '["いいえ", "はい"]', true, 42),
('11111111-1111-1111-1111-111111111112', '問診', '入れ歯の状態', 'radio', '["不具合なし", "噛むと痛い", "不安定", "違和感が強い"]', false, 43),
('11111111-1111-1111-1111-111111111112', '問診', '該当する項目', 'checkbox', '["舌や歯茎に触れると吐き気が出やすい", "むせやすい", "口を長時間開けていられない", "口を大きく開けられない", "椅子を倒すのがツラい", "宗教・思想的観点から使用できない医療製品（ブタなど）・血液製剤などがある"]', false, 44),
('11111111-1111-1111-1111-111111111112', '問診', 'その他要望等', 'textarea', NULL, false, 45);

-- 歯科疾患管理セクション
INSERT INTO questionnaire_questions (questionnaire_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '全身の疾患', 'radio', '["ない", "ある"]', true, 46),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '具体的な全身疾患', 'checkbox', '["糖尿病", "高血圧症", "呼吸器疾患", "心血管疾患", "妊婦", "その他"]', false, 47),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '服用歴', 'radio', '["なし", "あり"]', true, 48),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '1日の歯磨き回数', 'number', NULL, true, 49),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '歯磨きの時間', 'checkbox', '["朝食後", "昼食後", "夕食後", "就寝前"]', true, 50),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '習慣的飲料物', 'checkbox', '["炭酸飲料", "ジュース", "その他"]', false, 51),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '間食の取り方', 'radio', '["しない", "規則正しい", "不規則"]', true, 52),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '歯口清掃器具の使用', 'checkbox', '["歯ブラシ", "フロス", "歯間ブラシ", "なし"]', true, 53),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '喫煙習慣', 'radio', '["無", "有", "過去に有り"]', true, 54),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '睡眠時間', 'radio', '["十分", "やや不足", "不足"]', true, 55),
('11111111-1111-1111-1111-111111111112', '歯科疾患管理', '歯磨き方法', 'radio', '["習ったことがある", "習ったことがない"]', true, 56);

-- 同意事項セクション
INSERT INTO questionnaire_questions (questionnaire_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('11111111-1111-1111-1111-111111111112', '同意事項', 'オンライン資格確認: 薬剤情報、特定健診情報等の診療情報を取得・活用することへの同意について', 'radio', '["同意する", "同意しない"]', true, 57),
('11111111-1111-1111-1111-111111111112', '同意事項', '口腔内写真の撮影・使用: 治療説明、学会発表、ソーシャルメディア等での匿名使用への同意について', 'radio', '["同意する", "同意しない"]', true, 58);

-- 条件分岐ロジックの追加
-- 歯の色で気になる点は「歯の色は気になりますか？」で「はい」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "歯の色は気になりますか", "condition": "equals", "value": "はい", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '歯の色で気になる点';

-- 麻酔・抜歯異常の詳細は「麻酔や抜歯での異常経験」で「ある」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "麻酔や抜歯での異常経験", "condition": "equals", "value": "ある", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '麻酔・抜歯異常の詳細';

-- アレルギーの詳細は「薬・食物・金属などのアレルギー」で「ある」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "薬・食物・金属などのアレルギー", "condition": "equals", "value": "ある", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = 'アレルギーの詳細';

-- アレルギーの原因は「薬・食物・金属などのアレルギー」で「ある」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "薬・食物・金属などのアレルギー", "condition": "equals", "value": "ある", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = 'アレルギーの原因';

-- 具体的な持病は「持病・通院中の病気」で「ある」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "持病・通院中の病気", "condition": "equals", "value": "ある", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '具体的な持病';

-- 病名・病院名・診療科・医師名は「具体的な持病」で何かを選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "具体的な持病", "condition": "is_not_empty", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '病名・病院名・診療科・医師名';

-- 薬剤名・お薬手帳の有無・定期的な点滴・注射の有無は「現在服用しているお薬」で「ある」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "現在服用しているお薬", "condition": "equals", "value": "ある", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '薬剤名・お薬手帳の有無・定期的な点滴・注射の有無';

-- 妊娠週数は「妊娠・授乳の有無」で「はい」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "妊娠・授乳の有無", "condition": "equals", "value": "はい", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '妊娠週数';

-- 出産予定日は「妊娠・授乳の有無」で「はい」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "妊娠・授乳の有無", "condition": "equals", "value": "はい", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '出産予定日';

-- 入れ歯の状態は「入れ歯の使用」で「はい」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "入れ歯の使用", "condition": "equals", "value": "はい", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '入れ歯の状態';

-- 具体的な全身疾患は「全身の疾患」で「ある」を選択した場合のみ必須
UPDATE questionnaire_questions 
SET conditional_logic = '{"depends_on": "全身の疾患", "condition": "equals", "value": "ある", "required_when": true}'::jsonb
WHERE questionnaire_id = '11111111-1111-1111-1111-111111111112' 
AND question_text = '具体的な全身疾患';
