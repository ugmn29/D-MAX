-- 習慣チェック表を完全に再構築
-- 既存の質問を削除して、新しい構造で作成

-- 既存の習慣チェック表の質問を削除
DELETE FROM system_questionnaire_template_questions
WHERE template_id = '00000000-0000-0000-0000-000000000002';

-- 既存の問診票の習慣チェック表の質問も削除
DELETE FROM questionnaire_questions
WHERE questionnaire_id IN (
  SELECT id FROM questionnaires WHERE name = '習慣チェック表'
);

-- 舌に関する習癖（sort_order 1-5）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '舌', '舌の先をまるめる', 'checkbox', '["上に丸める", "下に丸める"]', false, 1),
('00000000-0000-0000-0000-000000000002', '舌', 'かむ', 'checkbox', '["該当する"]', false, 2),
('00000000-0000-0000-0000-000000000002', '舌', 'もてあそぶ', 'checkbox', '["右にひねる", "左にひねる"]', false, 3),
('00000000-0000-0000-0000-000000000002', '舌', '舌で前歯を', 'checkbox', '["押す", "触る"]', false, 4),
('00000000-0000-0000-0000-000000000002', '舌', '舌を出す', 'checkbox', '["昼間", "睡眠中", "しゃべるとき", "食べるとき"]', false, 5);

-- 口唇に関する習癖（sort_order 6-12）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '口唇', '吸う', 'checkbox', '["該当する"]', false, 6),
('00000000-0000-0000-0000-000000000002', '口唇', 'かむ', 'checkbox', '["上唇", "下唇"]', false, 7),
('00000000-0000-0000-0000-000000000002', '口唇', '前方へ突き出す', 'checkbox', '["該当する"]', false, 8),
('00000000-0000-0000-0000-000000000002', '口唇', '内側にまき込む', 'checkbox', '["上唇", "下唇", "両方の唇"]', false, 9),
('00000000-0000-0000-0000-000000000002', '口唇', 'なめる', 'checkbox', '["上", "下"]', false, 10),
('00000000-0000-0000-0000-000000000002', '口唇', '日中開いていることが多い', 'checkbox', '["大きく", "小さく"]', false, 11),
('00000000-0000-0000-0000-000000000002', '口唇', 'すぼめる', 'checkbox', '["該当する"]', false, 12);

-- その他の癖（sort_order 13-22）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order, placeholder) VALUES
('00000000-0000-0000-0000-000000000002', 'その他の癖', '指しゃぶり（歳～歳頃）', 'text', NULL, false, 13, '例: 0歳～3歳頃'),
('00000000-0000-0000-0000-000000000002', 'その他の癖', 'おしゃぶり（歳～歳頃）', 'text', NULL, false, 14, '例: 0歳～2歳頃'),
('00000000-0000-0000-0000-000000000002', 'その他の癖', '爪かみ', 'text', NULL, false, 15, '該当する場合: 手/足、年齢を記入'),
('00000000-0000-0000-0000-000000000002', 'その他の癖', 'エンピツをかむ（歳～歳頃）', 'text', NULL, false, 16, '例: 5歳～10歳頃'),
('00000000-0000-0000-0000-000000000002', 'その他の癖', 'タオルを', 'text', NULL, false, 17, '該当する場合: かむ/吸う、年齢を記入'),
('00000000-0000-0000-0000-000000000002', 'その他の癖', '哺乳瓶長期使用（歳 ヵ月頃まで）', 'text', NULL, false, 18, '例: 2歳6ヵ月頃まで'),
('00000000-0000-0000-0000-000000000002', 'その他の癖', '歯ぎしり（歳～歳頃）', 'text', NULL, false, 19, '例: 5歳～現在'),
('00000000-0000-0000-0000-000000000002', 'その他の癖', '母乳が長いと思う（歳 ヵ月頃まで）', 'text', NULL, false, 22, '例: 1歳6ヵ月頃まで');

INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', 'その他の癖', '異常嚥下癖', 'checkbox', '["該当する"]', false, 20),
('00000000-0000-0000-0000-000000000002', 'その他の癖', '頬づえ', 'checkbox', '["該当する"]', false, 21);

-- 睡眠中の習癖（sort_order 23-35）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '睡眠中', '口が開いている', 'checkbox', '["該当する"]', false, 23),
('00000000-0000-0000-0000-000000000002', '睡眠中', '舌が出ている', 'checkbox', '["該当する"]', false, 24),
('00000000-0000-0000-0000-000000000002', '睡眠中', '口唇をかんで寝ている', 'checkbox', '["上唇", "下唇"]', false, 25),
('00000000-0000-0000-0000-000000000002', '睡眠中', '上を向いて寝る', 'checkbox', '["該当する"]', false, 26),
('00000000-0000-0000-0000-000000000002', '睡眠中', '顔を横に向けて寝ることが多い', 'checkbox', '["左を向く", "右を向く"]', false, 27),
('00000000-0000-0000-0000-000000000002', '睡眠中', '布団をかぶって寝る', 'checkbox', '["該当する"]', false, 28),
('00000000-0000-0000-0000-000000000002', '睡眠中', '布団が固いと眠れない', 'checkbox', '["該当する"]', false, 29),
('00000000-0000-0000-0000-000000000002', '睡眠中', '横を向いて丸くなって寝る', 'checkbox', '["右側を下にして眠る", "左側を下にして眠る"]', false, 30),
('00000000-0000-0000-0000-000000000002', '睡眠中', 'うつぶせで寝る事が多い', 'checkbox', '["右側を下にして眠る", "左側を下にして眠る"]', false, 31),
('00000000-0000-0000-0000-000000000002', '睡眠中', '枕がないと眠れない', 'checkbox', '["高い枕", "普通", "低い", "手枕"]', false, 32),
('00000000-0000-0000-0000-000000000002', '睡眠中', '枕の位置は？', 'checkbox', '["頭", "首", "ほっぺた", "下顎"]', false, 33),
('00000000-0000-0000-0000-000000000002', '睡眠中', '夜はベッドで寝ている', 'checkbox', '["該当する"]', false, 34),
('00000000-0000-0000-0000-000000000002', '睡眠中', 'いびきがある', 'checkbox', '["該当する"]', false, 35);

-- 食生活（sort_order 101-130）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '食生活', '3度の食事をきちんと食べる', 'checkbox', '["該当する"]', false, 101),
('00000000-0000-0000-0000-000000000002', '食生活', '食が細い', 'checkbox', '["間食が多くておなかがすかない", "カラダをあまり動かさないためおなかがすかない", "好き嫌いが多い"]', false, 102),
('00000000-0000-0000-0000-000000000002', '食生活', 'お煎餅やりんごなどを小さくかんで食べる', 'checkbox', '["該当する"]', false, 103),
('00000000-0000-0000-0000-000000000002', '食生活', '食べ物を小さく切る', 'checkbox', '["母", "自分", "その他"]', false, 104),
('00000000-0000-0000-0000-000000000002', '食生活', '奥歯であまりかまない', 'checkbox', '["該当する"]', false, 105),
('00000000-0000-0000-0000-000000000002', '食生活', '前歯をあまり使わない', 'checkbox', '["該当する"]', false, 106),
('00000000-0000-0000-0000-000000000002', '食生活', 'お茶漬けなどの汁物が多い', 'checkbox', '["該当する"]', false, 107),
('00000000-0000-0000-0000-000000000002', '食生活', '食事中に水分を取ることが多い', 'checkbox', '["味噌汁", "牛乳", "お茶", "水", "その他"]', false, 108),
('00000000-0000-0000-0000-000000000002', '食生活', '口の中に入れる量はどれぐらい？', 'checkbox', '["多いと思う", "適当だと思う", "少ないと思う"]', false, 109),
('00000000-0000-0000-0000-000000000002', '食生活', '食べ物がいつまでも口の中に残っている', 'checkbox', '["該当する"]', false, 110),
('00000000-0000-0000-0000-000000000002', '食生活', '食事中クチャクチャ音がする', 'checkbox', '["該当する"]', false, 111),
('00000000-0000-0000-0000-000000000002', '食生活', 'かんでる時には口も一緒に開いているようだ', 'checkbox', '["該当する"]', false, 112),
('00000000-0000-0000-0000-000000000002', '食生活', 'かむ回数が少ないと思う', 'checkbox', '["該当する"]', false, 113),
('00000000-0000-0000-0000-000000000002', '食生活', '一度でなかなか飲み込めない', 'checkbox', '["口から出してしまう", "２、３回に分けて飲み込んでいるようだ"]', false, 114),
('00000000-0000-0000-0000-000000000002', '食生活', '食事中の姿勢は悪いと思う', 'checkbox', '["すわりかたが悪い", "食器の持ち方が悪い", "かむときの姿勢"]', false, 115),
('00000000-0000-0000-0000-000000000002', '食生活', 'テレビを見ながら食べている', 'checkbox', '["テレビは正面にある", "右横", "左横", "目線より上", "目線より下"]', false, 116),
('00000000-0000-0000-0000-000000000002', '食生活', '舌が食べ物を迎えにいく', 'checkbox', '["首を前に突き出して食べている", "カラダを起こしているが口に食べ物を入れるとき舌が先に出てくる"]', false, 117),
('00000000-0000-0000-0000-000000000002', '食生活', '野菜をあまり食べない', 'checkbox', '["生野菜", "煮野菜", "どちらも食べない"]', false, 118),
('00000000-0000-0000-0000-000000000002', '食生活', 'おやつが多い', 'checkbox', '["主に飲み物", "主にスナック菓子", "その他"]', false, 119),
('00000000-0000-0000-0000-000000000002', '食生活', '柔らか食事が多いと思う', 'checkbox', '["あまり固い物は食べない", "筋があり繊維が強い物は食べない"]', false, 120),
('00000000-0000-0000-0000-000000000002', '食生活', '濃い味付けを好む', 'checkbox', '["母の味付けが濃い", "自分で醤油やケチャップなどの調味料をかけて味を濃くする"]', false, 121),
('00000000-0000-0000-0000-000000000002', '食生活', '薬がうまく飲み込めない', 'checkbox', '["粉薬", "錠剤", "両方"]', false, 122),
('00000000-0000-0000-0000-000000000002', '食生活', '食べ物のかすが口唇の両端にたまる', 'checkbox', '["該当する"]', false, 123),
('00000000-0000-0000-0000-000000000002', '食生活', '食べながらよくこぼす', 'checkbox', '["該当する"]', false, 124),
('00000000-0000-0000-0000-000000000002', '食生活', '麺類をかむように食べる（つるつる一気に吸い上げれない）', 'checkbox', '["該当する"]', false, 125),
('00000000-0000-0000-0000-000000000002', '食生活', '食器を置いたまま食べる', 'checkbox', '["該当する"]', false, 126),
('00000000-0000-0000-0000-000000000002', '食生活', '飲み物が多い', 'checkbox', '["食事中", "普段", "水", "お茶", "甘い飲み物", "その他"]', false, 127),
('00000000-0000-0000-0000-000000000002', '食生活', '朝食はパンが多い', 'checkbox', '["該当する"]', false, 128),
('00000000-0000-0000-0000-000000000002', '食生活', '朝の食事は早く食べなさいとせかされることが多い', 'checkbox', '["該当する"]', false, 129),
('00000000-0000-0000-0000-000000000002', '食生活', '噛み方がおかしい', 'checkbox', '["右側だけでかんでいる", "左側だけでかんでいる", "前のほうで噛んでいる事が多い"]', false, 130);

-- 姿勢（sort_order 201-246）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '姿勢', '自分で姿勢が悪いと思う', 'checkbox', '["家", "学校", "幼稚園", "保育園", "食事中", "テレビ", "ゲーム", "勉強中", "本を読んでいるとき", "寝ているとき", "走っているとき"]', false, 201),
('00000000-0000-0000-0000-000000000002', '姿勢', '最近、目が悪くなってきた', 'checkbox', '["右目", "左目"]', false, 202),
('00000000-0000-0000-0000-000000000002', '姿勢', '休日や暇な時は、家でゴロゴロしている', 'checkbox', '["該当する"]', false, 203),
('00000000-0000-0000-0000-000000000002', '姿勢', '頬づえをよくつく', 'checkbox', '["右から", "左から"]', false, 204),
('00000000-0000-0000-0000-000000000002', '姿勢', '学校から帰るとぐったりするか、ゴロゴロする', 'checkbox', '["該当する"]', false, 205),
('00000000-0000-0000-0000-000000000002', '姿勢', '壁の側では、壁に寄りかかってしまう', 'checkbox', '["右側", "左側", "後ろ"]', false, 206),
('00000000-0000-0000-0000-000000000002', '姿勢', 'イスに座っている時に、寄りかかることが多い', 'checkbox', '["右側", "左側", "後ろ"]', false, 207),
('00000000-0000-0000-0000-000000000002', '姿勢', '座ったときは脱力していることが多い', 'checkbox', '["該当する"]', false, 208),
('00000000-0000-0000-0000-000000000002', '姿勢', 'イスに座ると足を組んでしまうことが多い', 'checkbox', '["右足を左足の上に乗せる", "左足を右足の上に乗せる", "両方"]', false, 209),
('00000000-0000-0000-0000-000000000002', '姿勢', '横座りをしている', 'checkbox', '["右足を横に出す", "左足を横に出す"]', false, 210),
('00000000-0000-0000-0000-000000000002', '姿勢', '両足の間にお尻を落として座っている', 'checkbox', '["該当する"]', false, 211),
('00000000-0000-0000-0000-000000000002', '姿勢', '自宅でソファーに座ることが多い', 'checkbox', '["該当する"]', false, 212),
('00000000-0000-0000-0000-000000000002', '姿勢', '歩く時は、がに股になってしまう', 'checkbox', '["該当する"]', false, 213),
('00000000-0000-0000-0000-000000000002', '姿勢', '歩く時は 内股歩きになってしまう', 'checkbox', '["該当する"]', false, 214),
('00000000-0000-0000-0000-000000000002', '姿勢', '歩く時は、外股歩きになってしまう', 'checkbox', '["該当する"]', false, 215),
('00000000-0000-0000-0000-000000000002', '姿勢', '靴が変な減り方をする', 'checkbox', '["外側が磨り減る", "内側が磨り減る", "つま先が磨り減る", "かかとが磨り減る", "右側だけ磨り減る", "左側だけ磨り減る"]', false, 216),
('00000000-0000-0000-0000-000000000002', '姿勢', '身体が弱いので何か、スポーツをやりたいと思っている', 'checkbox', '["該当する"]', false, 217);

INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order, placeholder) VALUES
('00000000-0000-0000-0000-000000000002', '姿勢', '健康のためスポーツ施設に通っている', 'text', NULL, false, 218, 'スポーツ名を記入'),
('00000000-0000-0000-0000-000000000002', '姿勢', '部活をやっている', 'text', NULL, false, 219, 'クラブ名を記入');

INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '姿勢', '歯ぎしりがひどい', 'checkbox', '["該当する"]', false, 220),
('00000000-0000-0000-0000-000000000002', '姿勢', '普段自転車に乗ることが多い', 'checkbox', '["該当する"]', false, 221),
('00000000-0000-0000-0000-000000000002', '姿勢', '歩くとき下向きの姿勢が多い', 'checkbox', '["該当する"]', false, 222),
('00000000-0000-0000-0000-000000000002', '姿勢', '床に寝そべって絵や字を書く事が多い', 'checkbox', '["該当する"]', false, 223),
('00000000-0000-0000-0000-000000000002', '姿勢', '寝ながら本を読む事が多い', 'checkbox', '["上を向く", "うつぶせになり下を向く", "右を向く", "左を向く"]', false, 224),
('00000000-0000-0000-0000-000000000002', '姿勢', 'パソコンやテレビゲームをよくする', 'checkbox', '["該当する"]', false, 225),
('00000000-0000-0000-0000-000000000002', '姿勢', '食事をする時、つい口の方を食べ物に近づけてしまう', 'checkbox', '["首を前に突き出す", "体が前に倒れる", "両方の動作をする"]', false, 226),
('00000000-0000-0000-0000-000000000002', '姿勢', '下向きに歩いている事が多い', 'checkbox', '["該当する"]', false, 227),
('00000000-0000-0000-0000-000000000002', '姿勢', 'テレビを横向きになって見ている事が多い', 'checkbox', '["右側にテレビがある", "正面", "左側にテレビがある", "上向き", "下向き"]', false, 228),
('00000000-0000-0000-0000-000000000002', '姿勢', '食事の時ひじを着いてしまう', 'checkbox', '["右ひじ", "左ひじ"]', false, 229),
('00000000-0000-0000-0000-000000000002', '姿勢', '食事中の姿勢が悪い', 'checkbox', '["カラダを倒す", "カラダをひねる", "首を曲げる", "足を出す"]', false, 230),
('00000000-0000-0000-0000-000000000002', '姿勢', '寝相が悪い', 'checkbox', '["該当する"]', false, 231),
('00000000-0000-0000-0000-000000000002', '姿勢', '整体に行ったことがある', 'checkbox', '["該当する"]', false, 232),
('00000000-0000-0000-0000-000000000002', '姿勢', '身体が曲がっていると言われた', 'checkbox', '["該当する"]', false, 233),
('00000000-0000-0000-0000-000000000002', '姿勢', 'ショルダーバッグをかけにくい', 'checkbox', '["右側がかけにくい", "左側がかけにくい"]', false, 234),
('00000000-0000-0000-0000-000000000002', '姿勢', '顔が傾いている事が多い', 'checkbox', '["右に傾く", "左に傾く"]', false, 235),
('00000000-0000-0000-0000-000000000002', '姿勢', '新聞や本を床に置いて読む事が多い', 'checkbox', '["該当する"]', false, 236),
('00000000-0000-0000-0000-000000000002', '姿勢', '猫背だと思う', 'checkbox', '["該当する"]', false, 237),
('00000000-0000-0000-0000-000000000002', '姿勢', 'いつも肩がこっている', 'checkbox', '["左", "右"]', false, 238),
('00000000-0000-0000-0000-000000000002', '姿勢', '走る時身体が前に倒れ過ぎていると思う', 'checkbox', '["該当する"]', false, 239),
('00000000-0000-0000-0000-000000000002', '姿勢', 'よく便秘する', 'checkbox', '["該当する"]', false, 240),
('00000000-0000-0000-0000-000000000002', '姿勢', '喘息だと言われた事がある', 'checkbox', '["該当する"]', false, 241),
('00000000-0000-0000-0000-000000000002', '姿勢', '御飯が食べられないほど疲れる', 'checkbox', '["該当する"]', false, 242),
('00000000-0000-0000-0000-000000000002', '姿勢', '腰痛を経験した事がある', 'checkbox', '["右側が痛かった", "左側が痛かった", "腰の後ろ側が痛かった"]', false, 243),
('00000000-0000-0000-0000-000000000002', '姿勢', 'いつもアゴがあがっている', 'checkbox', '["該当する"]', false, 244),
('00000000-0000-0000-0000-000000000002', '姿勢', 'テーブル、机に向かうとすぐひじをつく', 'checkbox', '["右側をつく", "左側をつく", "両方ひじをつき前によりかかってしまう"]', false, 245),
('00000000-0000-0000-0000-000000000002', '姿勢', '寝そべってテレビを見ている', 'checkbox', '["うつぶせ", "仰向け", "横になって"]', false, 246);

-- 鼻に関するもの（sort_order 301-308）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '鼻に関するもの', '花粉症', 'checkbox', '["該当する"]', false, 301),
('00000000-0000-0000-0000-000000000002', '鼻に関するもの', '蓄膿症', 'checkbox', '["該当する"]', false, 302),
('00000000-0000-0000-0000-000000000002', '鼻に関するもの', '鼻中隔湾曲症', 'checkbox', '["該当する"]', false, 303),
('00000000-0000-0000-0000-000000000002', '鼻に関するもの', 'アレルギー性鼻炎', 'checkbox', '["該当する"]', false, 304),
('00000000-0000-0000-0000-000000000002', '鼻に関するもの', '鼻血をよく出す', 'checkbox', '["該当する"]', false, 305),
('00000000-0000-0000-0000-000000000002', '鼻に関するもの', '鼻をクンクン鳴らす', 'checkbox', '["該当する"]', false, 306),
('00000000-0000-0000-0000-000000000002', '鼻に関するもの', '鼻かみがへただ', 'checkbox', '["該当する"]', false, 307),
('00000000-0000-0000-0000-000000000002', '鼻に関するもの', 'その他（鼻）', 'checkbox', '["該当する"]', false, 308);

-- 耳に関するもの（sort_order 401-403）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '耳に関するもの', '急性中耳炎', 'checkbox', '["該当する"]', false, 401),
('00000000-0000-0000-0000-000000000002', '耳に関するもの', '滲出性中耳炎', 'checkbox', '["該当する"]', false, 402),
('00000000-0000-0000-0000-000000000002', '耳に関するもの', 'その他（耳）', 'checkbox', '["該当する"]', false, 403);

-- 喉に関するもの（sort_order 501-506）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', '喉に関するもの', '扁桃腺肥大', 'checkbox', '["該当する"]', false, 501),
('00000000-0000-0000-0000-000000000002', '喉に関するもの', 'アデノイド肥大', 'checkbox', '["該当する"]', false, 502),
('00000000-0000-0000-0000-000000000002', '喉に関するもの', '喘息気管支炎', 'checkbox', '["該当する"]', false, 503),
('00000000-0000-0000-0000-000000000002', '喉に関するもの', 'タンがからむ', 'checkbox', '["該当する"]', false, 504),
('00000000-0000-0000-0000-000000000002', '喉に関するもの', '風邪をひくとよく熱を出す', 'checkbox', '["該当する"]', false, 505),
('00000000-0000-0000-0000-000000000002', '喉に関するもの', 'その他（喉）', 'checkbox', '["該当する"]', false, 506);

-- その他の病気（sort_order 601-608）
INSERT INTO system_questionnaire_template_questions (template_id, section_name, question_text, question_type, options, is_required, sort_order) VALUES
('00000000-0000-0000-0000-000000000002', 'その他', '股関節脱臼', 'checkbox', '["該当する"]', false, 601),
('00000000-0000-0000-0000-000000000002', 'その他', '骨形成不全', 'checkbox', '["該当する"]', false, 602),
('00000000-0000-0000-0000-000000000002', 'その他', '骨折', 'checkbox', '["該当する"]', false, 603),
('00000000-0000-0000-0000-000000000002', 'その他', '顎関節症', 'checkbox', '["該当する"]', false, 604),
('00000000-0000-0000-0000-000000000002', 'その他', 'アキレス腱切断', 'checkbox', '["該当する"]', false, 605),
('00000000-0000-0000-0000-000000000002', 'その他', '自家中毒', 'checkbox', '["該当する"]', false, 606),
('00000000-0000-0000-0000-000000000002', 'その他', 'チック症', 'checkbox', '["該当する"]', false, 607),
('00000000-0000-0000-0000-000000000002', 'その他', 'その他の病気', 'checkbox', '["該当する"]', false, 608);

-- システムテンプレートから既存の問診票に質問をコピー
DO $$
DECLARE
  questionnaire_record RECORD;
BEGIN
  FOR questionnaire_record IN
    SELECT id FROM questionnaires WHERE name = '習慣チェック表'
  LOOP
    -- システムテンプレートの質問を既存の問診票にコピー
    INSERT INTO questionnaire_questions (
      questionnaire_id,
      section_name,
      question_text,
      question_type,
      options,
      is_required,
      sort_order,
      conditional_logic,
      linked_field,
      placeholder
    )
    SELECT
      questionnaire_record.id,
      section_name,
      question_text,
      question_type,
      options,
      is_required,
      sort_order,
      conditional_logic,
      linked_field,
      placeholder
    FROM system_questionnaire_template_questions
    WHERE template_id = '00000000-0000-0000-0000-000000000002'
    ORDER BY sort_order;

    RAISE NOTICE '問診票 % に % 個の質問を追加しました',
      questionnaire_record.id,
      (SELECT COUNT(*) FROM system_questionnaire_template_questions WHERE template_id = '00000000-0000-0000-0000-000000000002');
  END LOOP;
END $$;
